varnishtest 3686

barrier b1 cond 2

server s1 {
        rxreqhdrs
        txresp -status 400 -body "Invalid request"
} -start

varnish v1 -vcl+backend { } -start

client c1 {
        txreq -method POST -hdr "Transfer-Encoding: chunked"
        chunkedlen 100
        barrier b1 sync
        chunkedlen 100
        chunkedlen 0
        rxresp
        expect resp.status == 400
        expect resp.body == "Invalid request"
} -start

server s1 -wait
barrier b1 sync
client c1 -wait
